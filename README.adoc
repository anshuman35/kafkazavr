= kafkazavr

How to use Kotlin and Ktor to build applications which share geographical coordinates.

== Map functionality

NOTE: Get Mapbox API key https://account.mapbox.com/access-tokens/create 

== TODO

* [x] modules for driver and rider
* [x] routes to separate file
* [ ] js files for rider UI
* [ ] create topics via config 

== Kafka 

[source,bash]
.docker stuff
----
# TODO: replace with TC
docker-compose up -d    #<1>
docker exec -it broker /usr/bin/kafka-topics --bootstrap-server broker:9092 --create --topic driver --partitions 3    #<2>
docker exec -it broker /usr/bin/kafka-topics --bootstrap-server broker:9092 --create --topic rider --partitions 3   #<3>
docker exec -it broker /usr/bin/kafka-topics --bootstrap-server broker:9092 --list    #<4>

docker exec -it broker /usr/bin/kafka-console-consumer --topic driver --bootstrap-server broker:9092 --property print.key=true --from-beginning #<5>
docker exec -it broker /usr/bin/kafka-console-consumer --topic rider --bootstrap-server broker:9092 --property print.key=true --from-beginning #<6>
----
<1> start zk and ak
<2> create driver topic
<3> create rider topic
<4> check if everything is there
<5> read driver topic

== test js

[source,javascript]
.filename
----
var ws = new WebSocket(wsUrl);
ws.send(JSON.stringify({driver: uuid})); // for driver
ws.send(JSON.stringify({rider: uuid})); // for rider
----


== Run Rider and Driver apps separately

Add command line argument:

* For driver app: -config=src/main/resources/driver.conf
* For rider app: -config=src/main/resources/rider.conf

To run both modules in the same application, just run as usual, without -config. In this caser, application.conf will be used